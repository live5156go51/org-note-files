Linux 常用操作
* 系统
** 内核和系统信息
|----------------+----------------------------|
|----------------+----------------------------|
| uname -a       | 获取内核版本               |
|----------------+----------------------------|
| lsb_release -a | 显示任何LSB发行版本信息    |
|----------------+----------------------------|
| uptime         | 显示系统主机名             |
|----------------+----------------------------|
| hostname       | 显示主机名                 |
| hostname -i    | 显示主机IP                 |
|----------------+----------------------------|
| man hier       | 描述文件系统目录结构       |
|----------------+----------------------------|
| last reboot    | 显示系统最后重启的历史记录 |
|----------------+----------------------------|

** 硬件信息
|-------------------+------------------------|
|-------------------+------------------------|
| dmesg             | 检测到的硬件和启动消息 |
|-------------------+------------------------|
| lsdev             | 关于已经安装的信息     |
|-------------------+------------------------|
| cat /proc/cpuinfo | CPU信息                |
|-------------------+------------------------|
| cat /proc/meminfo | 内存信息               |
|-------------------+------------------------|
| free -m           | 显示已用和空闲内存     |
|-------------------+------------------------|
| cat /proc/meminfo | 查看中断               |
|-------------------+------------------------|
| lspci -tv         | 显示PCI设备            |
|-------------------+------------------------|
| lsusb -tv         | 显示USB设备            |
|-------------------+------------------------|
| dmidecode         | 显示BIOS硬件信息       |
|-------------------+------------------------|
** 显示状态信息
|-------------------------------+----------------------------------|
|-------------------------------+----------------------------------|
| top                           | 显示和更新使用的进程             |
|-------------------------------+----------------------------------|
| mpstat 1                      | 显示进程相关信息 需要安装sysstat |
|-------------------------------+----------------------------------|
| vmstat 2                      | 显示虚拟内存的状态信息           |
|-------------------------------+----------------------------------|
| iostat 2                      | 显示I/O状态信息                  |
|-------------------------------+----------------------------------|
| tail -n 100 /var/log/messages | 显示最新100内核/系统信息         |
|-------------------------------+----------------------------------|
| tar /var/log/warn             | 显示系统警告信息                 |
|-------------------------------+----------------------------------|
** 用户
|------------------------------------------------------+---------------------------------------------|
|------------------------------------------------------+---------------------------------------------|
| id                                                   | 显示当前用户和用户组的ID                    |
|------------------------------------------------------+---------------------------------------------|
| last                                                 | 显示目前与过去登入系统的用户信息            |
|------------------------------------------------------+---------------------------------------------|
| who                                                  | 显示目前登入系统的用户信息                  |
|------------------------------------------------------+---------------------------------------------|
| groupadd group_name                                  | 建立用户组                                  |
|------------------------------------------------------+---------------------------------------------|
| useradd -e "personel name" -g group_name -m username | 添加新用户username并加入到group_name 用户组 |
|------------------------------------------------------+---------------------------------------------|
| passwd username                                      | 修改密码                                    |
|------------------------------------------------------+---------------------------------------------|
| userdel username                                     | 删除用户username                            |
|------------------------------------------------------+---------------------------------------------|
** 限制
|-------------------------------+----------------------------|
|-------------------------------+----------------------------|
| shell脚本相关                 |                            |
| ulimit -a                     | 查看shell限制状态信息      |
| ulimit -n 10240               | 更改使用脚本的使用限制     |
|-------------------------------+----------------------------|
| 用户进程相关                  |                            |
| cat /etc/security/limits.conf | 用户和应用程序限制配置     |
| * hard nproc 250              | 限制所有用户进程数         |
| arterisk hard nofile 409600   | 限制应用程序打开最大文件数 |
|-------------------------------+----------------------------|
| 系统级                        | 用sysctl来设置内核限制     |
| cat /etc/sysctl.conf          |                            |
| sysctl -a                     | 显示所有系统限制           |
| sysctl fs.file-max            | 显示系统最大文件打开数     |
| sysctl fs.file-max=10240      | 更改系统最大文件打开数     |
| cat /proc/sys/fs/file-nr      | 显示在使用的文件名柄数     |
|-------------------------------+----------------------------|
** 运行级别
|-----------------------------------------------------------+-------------------------------------------|
|-----------------------------------------------------------+-------------------------------------------|
| 内核加载完成  -> 启动init进程 -> 运行指定的rc运行级别脚本 |                                           |
|-----------------------------------------------------------+-------------------------------------------|
| /etc/init.d 目录脚本为rc运行级别符号链接执行脚本          |                                           |
| /etc/rc.d/rcN.d(N代表运行级别)的脚本                      | 并且都建立到/etc/init.d                   |
|-----------------------------------------------------------+-------------------------------------------|
| chkconfig --list                                          | 列出所有init脚本状态信息                  |
| chkconfig --list apache2                                  | 查看apache2在各个运行级别的启动配置       |
| chkconfig apache2 --level 2345 on                         | 对apache2在级别2345创建启动项             |
| chkconfig apache2 --level 2345 off                        | 去掉apache2在级别2345的启动               |
| chkconfig apache2 off                                     | 对所有运行级别下禁用apache2               |
|-----------------------------------------------------------+-------------------------------------------|
| Debian和基于Debian发行版像 Ubuntu                         | 使用命令 update-rc.d 来管理运行级别脚本。 |
| 默认启动为2,3,4 和 5,停止为 0,1 和 6。                    |                                           |
| update-rc.d apache2 defaults                              | 设置apache2为默认启动级别                 |
| update-rc.d -f apache2 remove                             | 对所有运行级别下禁用apache2               |
|-----------------------------------------------------------+-------------------------------------------|
  
** 内核模块
|----------------+------------------------|
|----------------+------------------------|
| lsmod          | 列出所有已载入内核模块 |
| modprobe hello | 载入hello模块          |
|----------------+------------------------|
** 编译内核
|----------------------+------------------------------------------------|
|----------------------+------------------------------------------------|
| cd /usr/src/linux*** | 进入内核文件位置                               |
|----------------------+------------------------------------------------|
| make mrproper        | 清除所有东西，包括配置文件                     |
| make oldconfig       | 从当前内核配置文件的基础上创建一个新的配置文件 |
| make menuconfig      | 选择xconfig(QT)或者gconfig(GTK)                |
| make                 | 创建一个压缩的内核映像文件                     |
| make modules         | 编译模块                                       |
| make modules_install | 安装模块                                       |
| make install         | 安装内核                                       |
| reboot               | 重启                                           |
|----------------------+------------------------------------------------|

* 进程
** 进程列表
|------------------+----------------------------|
|------------------+----------------------------|
| ps -auxefw       | 所有正在运行进程的详尽列表 |
|------------------+----------------------------|
| echo $$          | 显示正在使用shell的PID     |
|------------------+----------------------------|
| fuser -va 22/tcp | 列出使用商品22的进程       |
| fuser -va /boot  | 列出访问/boot分区的进程    |
|------------------+----------------------------|
| strace df        | 跟踪系统调用和信号         |
|------------------+----------------------------|
** 优先级
|--------------------------+-----------------------------------------------|
|--------------------------+-----------------------------------------------|
| renice                   | 更改正在运行进程的优先级，负值为更高的优先级  |
| renice -5 8415(PID)      | 高度更强的优先级                              |
|--------------------------+-----------------------------------------------|
| nice -n -5 top           | 更高优先级                                    |
| nice -n 5 top            | 更低优先级                                    |
|--------------------------+-----------------------------------------------|
| ionice                   | 调度磁盘 idle besteffort (real time) 三种类型 |
| ionice -c 3 -p 123       | 给pid 123设置为idle类型                       |
| ionice -c 2 -n 0 firefox | 用best effort 类型运行firefox并设为高先级     |
| ionice -c 3 -p$$         | 将当前进程shell的磁盘IO高度设置为idle类型     |
|--------------------------+-----------------------------------------------|
** 前台后台
|----------------------------+---------------------------------------|
|----------------------------+---------------------------------------|
| Ctrl+Z                     | 暂停                                  |
|----------------------------+---------------------------------------|
| bg                         | 调入后台继续运行                      |
|----------------------------+---------------------------------------|
| jobs -l                    | 后台进程列表                          |
|----------------------------+---------------------------------------|
| fg %n                      | 记进程n返回到前台运行                 |
|----------------------------+---------------------------------------|
| nohup                      | 开启一个持续运行的进程直到shell被关闭 |
| nohup ping ip > ping.txt & |                                       |
|----------------------------+---------------------------------------|

** Top
   - h键会显示帮助画面
   - u [用户名] 只显示属于此用户的进程。使用 + 或者空白可以查看所有用户
   - k [PID] 结束 PID 进程
   - 1显示所有进程状态信息
   - R 将当前排序倒转
   - q 退出
     
* 文件系统
** 权限
|--------------------------------+------------------------------|
|--------------------------------+------------------------------|
| chmod u+s /path/to/program     | 在可执行位设置SUID           |
| find / -perm -u+s -print       | 查找所有设置过SUID位的程序   |
|--------------------------------+------------------------------|
| chown user:group /path/to/file | 改变文件的所有者和文件关联组 |
| chgrp group /path/to/file      | 改变文件关联组               |
|--------------------------------+------------------------------|
** 磁盘信息
|---------------------+----------------------------|
|---------------------+----------------------------|
| hdparm -I /dev/sda  | 显示IDE/ATA磁盘信息        |
|---------------------+----------------------------|
| fdisk /dev/sda      | 交互式显示和修改磁盘分区表 |
|---------------------+----------------------------|
| smarctl -a /dev/sda | 显示磁盘检测信息           |
|---------------------+----------------------------|

** Boot
|----------------------+----------------------------------|
|----------------------+----------------------------------|
| mount                | 显示系统已挂载分区情况           |
|----------------------+----------------------------------|
| df -h                | 友好显示磁盘空间情况和挂载的设备 |
|----------------------+----------------------------------|
| cat /proc/partitions | 显示所有磁盘设备的所有分区       |
|----------------------+----------------------------------|
| du -csh              | 当前目录下总计所有文件大小总数   |
|----------------------+----------------------------------|
| du -ks *             | 加上管道sort -n -r由大到小排序   |
|----------------------+----------------------------------|
| ls -lSr              | 由小到大显示文件列表             |
|----------------------+----------------------------------|
      
** 查某程序打开了哪些文件
   -ps ax | grep emacs | awk '{print $1}'
   -lsof -p 1495(PID)
** 挂载重挂载一个文件系统
|-------------------------------------+-------------------------------|
|-------------------------------------+-------------------------------|
| mount -t auto /dev/cdrom /mnt/cdrom | 挂载CDROM命令                 |
|-------------------------------------+-------------------------------|
| dd if=/dev/cd0c of=file.iso         | 从CD拷贝原始数据到一个ISO文件 |
|-------------------------------------+-------------------------------|
** 挂载镜像文件
|----------------------------------------+----------------|
|----------------------------------------+----------------|
| mount -t iso9660 -o loop file.iso /mnt | 挂载CD镜像文件 |
|----------------------------------------+----------------|
| mount -t ext3 -o loop file.iso /mnt    | 用ext3         |
|----------------------------------------+----------------|
** 创建基于文件的镜像文件
   - dd if=/dev/zero of=/tmp/vdisk.img bs=1024 count=1024    #大小1G
   - mkfs.ext3 /tmp/vdisk.img 
   - mount -o loop /tmp.vdisk.img /mnt
** 创建基于内存的文件系统
   - mount -t tmpfs -osize=64m tmpfs /memdisk
     
* 网络
** 基本命令
|---------------------------------------------------+---------------------------------|
|---------------------------------------------------+---------------------------------|
| ethtool eth0                                      | 显示以太网状态                  |
|---------------------------------------------------+---------------------------------|
| ip link show                                      | 显示网络接口                    |
|---------------------------------------------------+---------------------------------|
| arp -a                                            | arp显示                         |
|---------------------------------------------------+---------------------------------|
| arping ipaddress                                  | 在网络层ping                    |
|---------------------------------------------------+---------------------------------|
| tcptraceroute -f 5 ipaddress                      | 使用tcp替换icmp跟踪，透过防火墙 |
|---------------------------------------------------+---------------------------------|
| route -n                                          | 内核路由表                      |
|---------------------------------------------------+---------------------------------|
| netstat -rn                                       | 内核路由表                      |
|---------------------------------------------------+---------------------------------|
| route add default gw 192.168.1.1                  | 配置默认路由                    |
|---------------------------------------------------+---------------------------------|
| ifconfig eth0 192.168.1.2 netmask 255.255.255.0   | 配置一个IP                      |
| ifconfig eth0:0 192.168.1.3 netmask 255.255.255.0 | 配置第二个IP                    |
|---------------------------------------------------+---------------------------------|
| ifconfig ech0 down                                |                                 |
| ifconfig eth0 hw ether 00:01:02:03:04:05          | ifconfig 更改MAC                |
|---------------------------------------------------+---------------------------------|
** 查看使用中的端口
    - netstat -an | grep LISTEN
    - netstat -tunl 
    - lsof -i 列出所在internet连接
    - socklist 列出打开的socket
    - netstat -anp --udp --tcp | grep LISTEN   查看端口
    - netstat -tup 列出活跃的连接
    - netstat -tupl 列出系统中正在监听的端口

** DNS
    - cat /resolv.conf   配置DNS条目
    - dig  转发查询
      - dig google.com
      - dig MX[A][NS] google.com
      - dig -x 119.147.15.17  反向查询
    - host
      - host -t MX[A] google.com 获取邮件MX记录
      - host -a google.com   获取所有
      - host 119.147.15.17 反向查询
      - nslookup 119.147.15.17
   
** 通信量分析
    - bmon   流量控制台  ？帮助
    - tcpdump 嗅探
      - tcpdump port 80 监听特定端口
      - tcpdump host google.com
      - tcpdump -n -i eth0 icmp 只捕获特定协议
      - tcpdump -i eth0 -s 0 -A port 80 | grep GET
      - 一些重要选项
	- -A 显示每个包清晰文本
	- -X 显示包的ASCII文本
	- -l 使标准输出变为缓冲形式
	- -D 显示所有可用网络接口
    - nmap 扫描
      - nmap google.com  扫描主机上所有保留的tcp端口
      - nmap -sP 192.168.1.0/24 查看在0/24网段上主机所使用的IP
      - nmap -V -A google.com 探测系统和系统服务版本信息
** 文件加密(交互式密码提示)
   - 单个文件
     - openssl des[des3] -salt -in file -out file.des  加密
     - openssl des[des3] -d -salt -in file.des -out file 解密
   - 整个目录
     - tar -zcf - directory |openssl des -salt -out directory.tar.gz.des 加密
     - openssl des -d -salt -in directory.tar.gz.des 解密
 
   - GPG
     - gpg -c file 加密
     - gpg file.gpg 解密

* 软件安装
|--------------------+------------------------|
|--------------------+------------------------|
| dpkg -l            | 列出已经安装的软件包   |
|--------------------+------------------------|
| dpkg -S file       | 查找拥有该file的软件包 |
|--------------------+------------------------|
| ldd /usr/bin/emacs | 列出所需的运行时库     |
|--------------------+------------------------|
* 媒体转换


